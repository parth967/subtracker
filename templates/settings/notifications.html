{% extends "base.html" %}

{% block title %}Email Notification Settings - RSVP Hub{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0"><i class="fas fa-bell me-2"></i>Email Notification Settings</h3>
                </div>
                <div class="card-body p-4">
                    <p class="text-muted mb-4">Choose which email notifications you'd like to receive. All emails are sent for free using our email service.</p>
                    
                    <form method="POST" action="{{ url_for('update_notification_settings') }}">
                        <!-- Master Toggle -->
                        <div class="card mb-4 border-0" style="background: #f8f9fa;">
                            <div class="card-body">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="email_notifications_enabled" 
                                           name="email_notifications_enabled" 
                                           {{ 'checked' if hasattr(current_user, 'email_notifications_enabled') and current_user.email_notifications_enabled else '' }}>
                                    <label class="form-check-label fw-bold" for="email_notifications_enabled">
                                        <i class="fas fa-envelope me-2 text-primary"></i>Enable Email Notifications
                                    </label>
                                    <p class="text-muted small mb-0 mt-2">Turn all email notifications on or off</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Individual Settings -->
                        <div class="notification-options">
                            <h5 class="mb-3">Notification Types</h5>
                            
                            <!-- New RSVP -->
                            <div class="card mb-3 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="email_new_rsvp" 
                                               name="email_new_rsvp" 
                                               {{ 'checked' if hasattr(current_user, 'email_new_rsvp') and current_user.email_new_rsvp else '' }}
                                               {{ 'disabled' if not (hasattr(current_user, 'email_notifications_enabled') and current_user.email_notifications_enabled) else '' }}>
                                        <label class="form-check-label" for="email_new_rsvp">
                                            <strong>New RSVP Notifications</strong>
                                        </label>
                                        <p class="text-muted small mb-0 mt-1">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Get notified instantly when someone RSVPs to your events
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Event Reminders -->
                            <div class="card mb-3 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="email_reminders" 
                                               name="email_reminders" 
                                               {{ 'checked' if hasattr(current_user, 'email_reminders') and current_user.email_reminders else '' }}
                                               {{ 'disabled' if not (hasattr(current_user, 'email_notifications_enabled') and current_user.email_notifications_enabled) else '' }}>
                                        <label class="form-check-label" for="email_reminders">
                                            <strong>Event Reminders</strong>
                                        </label>
                                        <p class="text-muted small mb-0 mt-1">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Receive reminders 1 day before your events
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Milestones -->
                            <div class="card mb-3 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="email_milestones" 
                                               name="email_milestones" 
                                               {{ 'checked' if hasattr(current_user, 'email_milestones') and current_user.email_milestones else '' }}
                                               {{ 'disabled' if not (hasattr(current_user, 'email_notifications_enabled') and current_user.email_notifications_enabled) else '' }}>
                                        <label class="form-check-label" for="email_milestones">
                                            <strong>RSVP Milestones</strong>
                                        </label>
                                        <p class="text-muted small mb-0 mt-1">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Celebrate when you reach 10, 25, 50, or 100 RSVPs
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Weekly Summary -->
                            <div class="card mb-3 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="email_weekly_summary" 
                                               name="email_weekly_summary" 
                                               {{ 'checked' if hasattr(current_user, 'email_weekly_summary') and current_user.email_weekly_summary else '' }}
                                               {{ 'disabled' if not (hasattr(current_user, 'email_notifications_enabled') and current_user.email_notifications_enabled) else '' }}>
                                        <label class="form-check-label" for="email_weekly_summary">
                                            <strong>Weekly Summary</strong>
                                        </label>
                                        <p class="text-muted small mb-0 mt-1">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Get a weekly digest of all your RSVP activity
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Info Box -->
                        <div class="alert alert-info mt-4">
                            <h6 class="alert-heading"><i class="fas fa-lightbulb me-2"></i>Free Email Service</h6>
                            <p class="mb-0 small">
                                We use free SMTP email service (Gmail/Outlook) - no API costs, completely free! 
                                All emails are sent securely and you can unsubscribe anytime.
                            </p>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="d-flex gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save me-2"></i>Save Settings
                            </button>
                            <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Email Setup Instructions -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-cog me-2"></i>Email Setup (Admin)</h5>
                </div>
                <div class="card-body">
                    <p class="small text-muted">To enable email notifications, add these to your <code>.env</code> file:</p>
                    <pre class="bg-dark text-light p-3 rounded small"><code># Gmail SMTP (Free, 500 emails/day)
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
FROM_EMAIL=your-email@gmail.com
FROM_NAME=RSVP Hub

# Or use Outlook (also free)
# SMTP_SERVER=smtp-mail.outlook.com
# SMTP_PORT=587</code></pre>
                    <p class="small text-muted mb-0">
                        <strong>Gmail Setup:</strong> Enable 2-factor auth → Google Account → Security → App Passwords → Generate password
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Enable/disable individual settings based on master toggle
document.getElementById('email_notifications_enabled').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.notification-options input[type="checkbox"]');
    checkboxes.forEach(cb => {
        cb.disabled = !this.checked;
    });
});
</script>
{% endblock %}

